<odoo>

  <!-- ===================== LIST VIEW ===================== -->
  <record id="view_estate_property_list" model="ir.ui.view">
    <field name="name">estate.property.list</field>
    <field name="model">estate.property</field>
    <field name="arch" type="xml">
      <list string="Properties"
            decoration-success="state in ('offer','accepted')"
            decoration-bf="state == 'accepted'"
            decoration-muted="state == 'sold'">
        <field name="name" string="Title"/>
        <field name="state"/>
        <field name="property_type_id"/>
        <field name="expected_price"/>
        <field name="selling_price" readonly="1"/>
        <field name="date_availability" optional="show"/>
        <field name="tag_ids" widget="many2many_tags"/>
      </list>
    </field>
  </record>

  <!-- ===================== FORM VIEW ===================== -->
  <record id="view_estate_property_form" model="ir.ui.view">
    <field name="name">estate.property.form</field>
    <field name="model">estate.property</field>
    <field name="arch" type="xml">
      <form string="Property">
        <header>
          <button name="action_sold"   type="object" string="Sold"   class="oe_highlight" invisible="state in ('sold','canceled')"/>
          <button name="action_cancel" type="object" string="Cancel"                   invisible="state in ('sold','canceled')"/>
          <field name="state" widget="statusbar" statusbar_visible="new,offer,accepted,sold,canceled"/>
        </header>

        <sheet>
          <group>
            <group>
              <field name="name"/>
              <field name="property_type_id" options="{'no_create_edit': True, 'no_open': True}"/>
              <field name="postcode"/>
              <field name="date_availability"/>
            </group>
            <group>
              <field name="expected_price"/>
              <field name="selling_price" readonly="1"/>
              <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
            </group>
          </group>

          <notebook>
            <page string="Description">
              <group>
                <group>
                  <field name="description" nolabel="1"/>
                </group>
                <group>
                  <field name="bedrooms"/>
                  <field name="living_area"/>
                  <field name="garden"/>
                  <field name="garden_area" invisible="not garden"/>
                  <field name="garden_orientation" widget="radio" invisible="not garden"/>
                  <field name="total_area" readonly="1"/>
                </group>
              </group>
            </page>

            <page string="Offers">
              <!-- O2M offers: readonly bila induk accepted/sold/canceled -->
              <field name="offer_ids" readonly="state in ('accepted','sold','canceled')">
                <list editable="bottom">
                  <field name="price"/>
                  <field name="partner_id"/>
                  <!-- Tombol ✓ ✗ diletakkan sebelum validity -->
                  <button name="action_accept" type="object" icon="fa-check" title="Accept" invisible="status != 'new'"/>
                  <button name="action_refuse" type="object" icon="fa-times" title="Refuse" invisible="status != 'new'"/>
                  <field name="validity"/>
                  <field name="date_deadline"/>
                </list>
                <form string="Offer">
                  <group>
                    <field name="price"/>
                    <field name="partner_id"/>
                    <field name="validity"/>
                    <field name="date_deadline" readonly="1"/>
                    <field name="status"/>
                  </group>
                </form>
              </field>
            </page>

            <page string="Other Info">
              <group>
                <group><field name="buyer_id"/></group>
                <group><field name="salesperson_id"/></group>
              </group>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- ===================== SEARCH VIEW ===================== -->
<record id="view_estate_property_search" model="ir.ui.view">
  <field name="name">estate.property.search</field>
  <field name="model">estate.property</field>
  <field name="arch" type="xml">
    <search string="Search Properties">
      <field name="name"/>
      <field name="living_area" filter_domain="[('living_area','>=', self)]"/>

      <!-- WAJIB pakai &lt;=, bukan <= -->
      <filter name="available" string="Available"
              domain="[('date_availability','&lt;=', context_today())]"/>

      <filter name="state_new" string="New" domain="[('state','=','new')]"/>
      <group expand="0" string="Group By">
        <filter name="group_state" string="State" context="{'group_by': 'state'}"/>
        <filter name="group_available" string="Availability Month"
                context="{'group_by': 'date_availability:month'}"/>
      </group>
    </search>
  </field>
</record>


  <!-- ===================== ACTION ===================== -->
  <record id="action_estate_property" model="ir.actions.act_window">
    <field name="name">Properties</field>
    <field name="res_model">estate.property</field>
    <field name="view_mode">list,form</field>
    <!-- Aktifkan filter 'available' secara default -->
    <field name="context">{'search_default_available': True}</field>
  </record>

</odoo>
